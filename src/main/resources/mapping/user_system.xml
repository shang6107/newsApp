<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cxgc.news_app.core.mapper.user_mapper.UserMapper">

    <resultMap id="user_result" type="com.cxgc.news_app.core.model.User">
        <id property="id" column="id"/>
        <result property="phoneNum" column="phone_num"/>
        <result property="nickName" column="nick_name"/>
        <result property="password" column="password"/>
        <result property="headImg" column="head_img"/>
        <result property="gender" column="gender"/>
        <result property="address" column="address"/>
        <result property="hobby" column="Hobby"/>
        <result property="introduce" column="introduce"/>
        <result property="lastTime" column="last_time"/>
        <result property="typeName" column="type_name"/>
        <result property="createTime" column="create_time"/>
    </resultMap>

    <resultMap id="ValidateCoder_result" type="com.cxgc.news_app.core.model.ValidateCode">
        <id property="id" column="id"/>
        <result property="code" column="code"/>
        <result property="phoneNum" column="phone_num"/>
        <result property="expireTime" column="expire_time"/>
        <result property="usable" column="usable"/>
        <result property="sent" column="sended"/>
        <result property="createTime" column="create_time"/>
    </resultMap>


<!--新增用户-->
<insert id="addUser" parameterType="com.cxgc.news_app.core.model.User">
    INSERT INTO users(id,phone_num,nick_name,create_time) VALUES (#{id},#{phoneNum},#{nickName},#{createTime})
</insert>
<!--存入验证码-->
    <insert id="addIdentifyingCode" parameterType="com.cxgc.news_app.core.model.ValidateCode">
        INSERT INTO validate_code VALUES (#{id},#{code},#{phoneNum},#{expireTime},#{usable},2,#{createTime})
    </insert>
<!--by电话获取用户信息-->
    <select id="getUserByPhone" resultMap="user_result">
        select * from users where phone_num=#{phoneNum}
    </select>
<!--查询验证码是否正确-->
    <select id="loginVerification" resultMap="ValidateCoder_result">
        select * from validate_code where phone_num=#{phoneNum} and code=#{code}
    </select>
<!--修改用户资料-->
    <update id="editUserInfo" parameterType="com.cxgc.news_app.core.model.User">
        update users
        <trim prefix="set" suffixOverrides=",">
            <if test="headImg != null">
                headImg =#{headImg},
            </if>
            <if test="hobby != null">
                hobby=#{hobby}
            </if>
            <if test="introduce != null">
                introduce=#{introduce}
            </if>
            <if test="address != null">
                address=#{address}
            </if>
        </trim>
        where id =#{id}
    </update>
<!--获取指定用户的历史浏览记录-->
    <select id="listHistory" parameterType="com.cxgc.news_app.core.model.User" resultType="com.cxgc.news_app.core.model.History">
        select * from history where user_id =#{id};
    </select>

    <!--获取指定用户的收藏-->
    <select id="listCollections" parameterType="com.cxgc.news_app.core.model.User" resultType="com.cxgc.news_app.core.model.Collections">
        select * from collections where user_id=#{id}
    </select>
   <!--获取指定用户评论信息-->
    <select id="listComment" parameterType="com.cxgc.news_app.core.model.User" resultType="com.cxgc.news_app.core.model.Comment">
        select * from comment where user_id = #{id}
    </select>

    <!--添加浏览记录-->
   <!-- <insert id="addHistory" parameterType="com.cxgc.news_app.core.model.History">
        insert into history values(#{},#{},#{})
    </insert>-->

    <!--添加收藏记录-->
   <!-- <insert id="addCollections" parameterType="com.cxgc.news_app.core.model.Collections">
        insert into collections values(#{},#{},#{})
    </insert>-->

    <!--添加评论记录-->
    <!--<insert id="addComment" parameterType="com.cxgc.news_app.core.model.Comment">
        insert into comment values(#{},#{},#{})
    </insert>-->
</mapper>
